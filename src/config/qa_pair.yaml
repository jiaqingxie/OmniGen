# QA Pair Generation Configuration
dataset_path: SpectrumWorld/multimodal-spectroscopic-seed-datasets-full
generator_type: qa_pair
generator_config:
  prompt_templates:
    single_step:
      template: |
        You are a highly analytical and scientifically rigorous computational chemist analyzing a molecular spectrum image. Your task is to generate a diverse, natural single-step question-answer conversation about this spectrum. The conversation MUST demonstrate sound scientific reasoning based ONLY on the visual evidence provided in the spectrum image.

        IMPORTANT CONSTRAINTS - YOU MUST USE THESE EXACT VALUES:
        - Molecular formula: {formula} 
        - SMILES notation: {smiles} 
        - Spectrum type: {spectrum_type}
        - Chemical Shifts: {chemical_shifts}

        SCIENTIFIC RIGOR REQUIREMENTS:
        1.  **Deductive Reasoning Only:** The final structure (Formula/SMILES) must be presented as the **conclusion of the analysis**, not as the starting point.
        2.  **No Unwarranted Precision:** Do not quote highly precise coupling constants (J values, e.g., "272.0 Hz") if they are not clearly measurable in the provided visual spectrum. Instead, describe the *effect* (e.g., "strong C-F coupling").
        3.  **Acknowledge Limitations:** Do not identify a specific halogen (e.g., 'Bromine') or provide a complete molecular formula unless the spectrum type and features alone allow it. Use conservative terms like 'Halogen' or 'Electron-withdrawing group'.
        4.  **Use Phase Information (C-NMR only):** If the spectrum is a DEPT/APT type (peaks going up and down), you MUST use the phase information (positive/negative signals) in your reasoning to assign $\text{CH}_2$ versus $\text{CH}/\text{CH}_3$.
        5.  **Data Consistency:** Ensure the multiplicity and integration mentioned in the answer *match* the visual data, **not** just the raw shifts provided in the prompt.

        TASK: Generate a natural conversation in the following JSON format:
        [
          {
            "from": "human",
            "value": "Your question here"
          },
          {
            "from": "gpt",
            "value": "Your scientifically rigorous, step-by-step response here. The response MUST integrate the visual evidence and satisfy the Scientific Rigor Requirements."
          }
        ]

        Vary your approach - use different question styles, response formats, and educational approaches.

        Examples of diverse question styles:
        - "What can you tell me about this {spectrum_type} spectrum?"
        - "Analyze this {spectrum_type} spectrum and identify the compound."
        - "What molecular information can be extracted from this {spectrum_type} spectrum?"
        - "Can you determine the structure from this {spectrum_type} spectrum?"
        - "What does this {spectrum_type} spectrum reveal about the molecule?"

        Examples of diverse response styles:
        - Direct identification: "The compound is {formula} (SMILES: {smiles})."
        - Analytical approach: "Based on the spectral features and chemical shifts {chemical_shifts}, this appears to be {formula}..."
        - Educational explanation: "Looking at this {spectrum_type} spectrum with shifts {chemical_shifts}, I can identify {formula}..."
        - Step-by-step reasoning: "From the spectral data, I can deduce that this is {formula}..."

        Requirements:
        - MUST use the exact formula and SMILES provided above
        - If chemical shifts are provided, reference them naturally (e.g., {chemical_shifts})
        - Create natural, varied conversations (not template-like)
        - Use different question phrasings and response styles
        - Make it educational and engaging
        - Write in clear, scientific English
        - Vary the conversation tone and approach
        - Focus on spectrum analysis and molecular identification
        - Use the EXACT JSON format shown above with "from" and "value" fields

        Please provide only the JSON conversation, no additional text.

    multi_step:
      template: |
        You are a highly analytical and scientifically rigorous computational chemist analyzing a molecular spectrum image. Generate a diverse, natural multi-step question-answer conversation about this spectrum. The conversation **MUST demonstrate sound scientific reasoning based on the visual evidence** and chemical principles.

                IMPORTANT CONSTRAINTS - YOU MUST USE THESE EXACT VALUES:
                - Molecular formula: {formula} (DO NOT CHANGE THIS)
                - SMILES notation: {smiles} (DO NOT CHANGE THIS)
                - Spectrum type: {spectrum_type}
                - Chemical Shifts: {chemical_shifts}

                TASK: Generate a natural multi-step conversation in the following JSON format:
                [
                  {
                    "from": "human",
                    "value": "First question here"
                  },
                  {
                    "from": "gpt",
                    "value": "First response here"
                  },
                  {
                    "from": "human",
                    "value": "Follow-up question here"
                  },
                  {
                    "from": "gpt",
                    "value": "Follow-up response here"
                  }
                ]
 
                Create varied, educational exchanges that build upon each other.

                Examples of diverse conversation flows:
                
                Flow 1 - Identification → Analysis:
                - Q: "What compound is this?" → A: "This is {formula}..."
                - Q: "What can you tell me about the spectral features?" → A: "The spectrum shows..."

                Flow 2 - Analysis → Confirmation:
                - Q: "Analyze this {spectrum_type} spectrum." → A: "Looking at the peaks and shifts {chemical_shifts}, this appears to be {formula}..."
                - Q: "How confident are you in that identification?" → A: "Very confident because..."

                Flow 3 - Educational → Deep Dive:
                - Q: "Can you help me understand this spectrum?" → A: "Of course! This {spectrum_type} spectrum (shifts {chemical_shifts}) shows {formula}..."
                - Q: "What specific features should I look for?" → A: "The key features are..."

                Flow 4 - Problem-solving → Explanation:
                - Q: "I'm having trouble interpreting this spectrum." → A: "Let me help you identify this as {formula}..."
                - Q: "What's the reasoning behind that conclusion?" → A: "The evidence comes from..."

                Requirements:
                - MUST use the exact formula and SMILES provided above
                - Create natural, varied multi-step conversations
                - Use different question styles and response approaches
                - Build educational progression between exchanges
                - Use chemical shifts {chemical_shifts} when relevant to reasoning
                - Vary conversation tone and teaching style
                - Make it engaging and informative
                - Focus on spectrum analysis and molecular identification
                - Ensure logical flow between questions and answers
                - Use the EXACT JSON format shown above with "from" and "value" fields
                
                **--- SCIENTIFIC RIGOR CONSTRAINTS ---**
                **1. DEDUCTIVE REASONING:** The final structure (Formula/SMILES) must be presented as the result of the analysis, not as a statement of fact at the beginning.
                **2. NO HALLUCINATION:**
                  **a.** The GPT response must not quote precise numerical data (like exact $J$ values in Hz, e.g., "272.0 Hz") if that data is not visually clear or measurable on the provided spectrum image. **Describe the *effect* (e.g., "strong C-F coupling") instead.**
                  **b.** **H-NMR (Proton):** When analyzing aromatic regions, do not definitively identify a specific halogen (e.g., 'Bromine') unless the spectrum provides irrefutable evidence. Use conservative terms like 'Halogen' or 'Electron-withdrawing group'.
                  **c.** **C-NMR (Carbon):** If the spectrum is a $\text{DEPT}$ or $\text{APT}$ type (indicated by peaks with opposing phases/directions), the response **MUST** utilize this phase information to correctly assign $\text{CH}/\text{CH}_3$ versus $\text{CH}_2$ fragments.
  qa_types: ["single_step", "multi_step"]
  
  # Conversation settings
  min_conversation_length: 2
  max_conversation_length: 6
  
  # Image output settings
  image_output_dir: "./tests_image/multimodal_output/full_multi_step_qa_interns1_spectrum_images"
  
  # Text generation settings
  max_out_len: 4096
  
  # Loader settings - limit source dataset to 3000 samples
  loader_kwargs:
    max_samples: 1200
    start_file_idx: 50

model_type: interns1
model_config:
  api_key: sk-o3mE7Y335YJBNz3mtjRjEvmKzzzHPv75gqTJviokS1q3G55P
  base_url: https://chat.intern-ai.org.cn/api/v1/
  model_name: intern-s1

num_samples: 1200
output_path: multimodal_output/full_multi_step_qa_pairs_interns1.json
verbose: true
max_retries: 3
